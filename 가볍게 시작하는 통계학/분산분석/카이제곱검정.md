[[카이제곱분포]]는 오차(error) 혹은 편차(deviation)가 우연히 발생한 것인지 아닌지 유의수준을 판별하는 것에 사용된다. 위 과정을 **카이제곱검정**이라고 부른다.

이것을 이해하기 위해서는 우리가 보통 error를 정규분포로 설계한다는 점을 이해해야 한다.
가령, 회귀분석을 이용한 모델 제작 시, 우리가 얻은 데이터들은 모델의 출력값을 중심으로 하는 정규분포에서 랜덤하게 샘플링되어 얻은 값이라고 보는 것이다.

![|500](https://i.stack.imgur.com/Wqrn4.png)
<그림 8. 회귀분석 시 오차에 대한 분포 설정>
<br>
그것 뿐만 아니라, 중심극한정리에 따라 샘플수가 무수히 많고 합(sum)을 이용해 오차를 정의하는 경우 오차의 분포는 정규분포를 따르게 된다.

그러므로 이렇듯 **오차 혹은 편차에 대한 분석을 수행할 때 카이제곱 분포를 이용하면 이 오차 혹은 편차가 우연히 발생할 수 있다고 볼 수 있을만한 수준의 것인지 그렇지 않은지를 판별할 수 있게 되는 것이다.**

## 카이제곱 통계량 
![[카이제곱 통계량]]


## 적합도 검정
적합도 검정은 독립변수가 하나이고 이론적으로 기대되는 빈도의 분포(frequency distribution)와 관찰한 빈도의 분포를 비교하기 위해 사용할 수 있다.
여기서 독립변수는 범주형 변수(categorical variable)이라는 점도 꼭 짚고 넘어가도록 하자.

적합도 검정은 아래 순서로 진행된다.
1. 가설 설정
2. 검정 통계량 계산($\chi^2$)
3. 특정 자유도와 p-value에 따른 카이제곱 통계량 값을 얻는다.
4. 검정 통계량과 카이제곱 통계량 값을 비교하여 가설을 검정한다. 

가설 설정에 있어 귀무가설은 각 범주형 변수의 값이 동일하다(비율이 동일하다)는 것이고 대립가설은 동일하지 않다는 것이다.
검정 통계량이 카이제곱 값보다 작을 경우

예를 들어 아래와 같은 데이터셋을 생각해보자.  

<p align = "center">

<img width = "500" src = "https://raw.githubusercontent.com/angeloyeo/angeloyeo.github.io/master/pics/2021-12-13-chi_square/pic9.png">

<br>

그림 9. 적합도 검정 수행해보기 위한 데이터셋

</p>

그림 9에 있는 데이터셋에서는 5가지 맛이 섞여 있는 사탕 주머니에서 총 100개의 사탕을 집어들어 어떤 맛의 사탕들을 고르게 되었는지 확인해본 가상의 실험이다.
카이제곱 적합도 검정을 하기 위해 가설을 아래와 같이 구성할 수 있다.
* 귀무가설 $H_0$ : $p_1 = p_2 = p_3 = p_4 = p_5$ : 5가지 맛이 동일한 비율로 들어있다.
* 대립가설 $H_1$ : $not\,\,\,\,p_1 = p_2 = p_3 = p_4 = p_5$ : 5가지 맛이 동일한 비율로 들어있지 않다.

처음에 예측하기로는 5가지 맛 사탕이 모두 골고루 들어 있을 것이라고 생각하였으므로 기댓값은 20개씩 설정하였다.

카이제곱 통계량 식을 그대로 적용해보면 다음과 같은 통계량을 얻을 수 있는 것을 알 수 있다.

$$\chi^2 = \frac{(17-20)^2}{20}+\frac{(16-20)^2}{20}+\frac{(24-20)^2}{20}+\frac{(29-20)^2}{20}+\frac{(14-20)^2}{20} = 7.9$$

총 5개의 카테고리가 있기 때문에 자유도는 4이다. 자유도가 4일 때 p-value 0.05에 해당하는 카이제곱 값(오른쪽 단측)은 $\chi^2(4)_{0.95} = 9.4877$이다. 
>자유도가 4이고 p-value가 0.05인 카이제곱 값은 $\chi^2_{0.05, 4}$ 와 같이 표현하기도 한다.

따라서,$\chi^2 < \chi^2(4)_{0.95}$ 임으로 이 사탕 주머니에 있는 사탕 5가지 종류 중 하나라도 다른 비율로 섞여있다고 보기에는 어렵다는 것이다. 아마 우연히 골고루 사탕을 집어들지 못했을 것으로 결론지을 수 있다.

  

## 교차 분석
교차 분석은 범주형 변수가 여러 개인 경우에 적용하는 분석 방법이다. 교차 분석의 목적은 여러 범주형 변수의 범주 간 차이가 기댓값에서 유의하게 벗어나는지 확인하는 것이다. 가령 아래와 같이 성별, 중국집 메뉴의 두 개의 범주형 변수에 대한 데이터를 확인해보자.
![<그림 10. 교차 분석을 수행하기 위한 데이터셋>|500](https://raw.githubusercontent.com/angeloyeo/angeloyeo.github.io/master/pics/2021-12-13-chi_square/pic10.png)
<그림 10. 교차 분석을 수행하기 위한 데이터셋>
<br>
위 데이터 셋은 범주형 변수가 두 개이며 성별 변수에는 범주가 2개, 메뉴 변수에는 범주가 3개인 케이스이다.
교차 분석에서도 마찬가지로 식 (2)에서 제시하는 통계량을 사용할 수 있다.

이 때, 기댓값을 계산해야 하는데 각 cell의 기댓값은 다음과 같이 계산할 수 있다.

$$\text{기댓값} = \frac{\text{해당 행 전체 합}\times\text{해당 열 전체 합}}{\text{전체 데이터 수}}$$
![<그림 11. 교차 분석 데이터셋의 기대빈도를 계산하는 방법과 결과>|500](https://raw.githubusercontent.com/angeloyeo/angeloyeo.github.io/master/pics/2021-12-13-chi_square/pic11.png)

<그림 11. 교차 분석 데이터셋의 기대빈도를 계산하는 방법과 결과>

<br>
그리고 교차분석 시 테이블의 행 갯수를 $r$, 열 갯수를 $c$라고 했을 때 자유도는 $(r-1)\times (c-1)$로 계산한다.

여기서 교차분석을 수행한다는 것은 각 메뉴별로 성별 간 선택의 차이를 보이는지, 혹은 각 성별 별로 메뉴 선택의 차이를 보이는지를 알아보는 것에 목적이 있다.

식 (2)에 따라 통계량을 구하면,

$$\chi^2 = \frac{(21-17.41)^2}{17.41} + \frac{(16-19.59)^2}{19.59} +

\frac{(13-13.18)^2}{13.18} \notag$$

$$+ \frac{(15-14.82)^2}{14.82} +

\frac{(6-9.41)^2}{9.41} + \frac{(14-10.59)^2}{10.59} = 3.7366$$

이 때, 자유도는 $(2-1)\times(3-1) = 2$ 이고 이 자유도에서 상위 95%에 해당하는 $\chi^2$ 값은

$$\chi^2(2)_{0.95} = 5.9915$$

임을 알 수 있다. 따라서, 우리가 구한 통계량이 5.9915보다는 작은 것을 알 수 있으며 성별 및 메뉴판에 대해 기댓값에서 유의하게 벗어나지 않는 결과를 보인다는 것을 알 수 있다.