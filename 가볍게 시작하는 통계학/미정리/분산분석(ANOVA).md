## 분산분석의 목적

비교하고자 하는 집단이 2개일 경우에 두 모집단의 표본평균이 같다($H_0: \mu_1 = \mu_2$)는 가설을 설정한 뒤 t-test를 진행하여 두 집단을 비교할 수 있었다.

3개 이상의 집단을 비교하고자 하는 경우 3개 이상의 레벨이 같다($H_0: \mu_1 = \mu_2 = ... = \mu_k$)는 가설을 설정 한 뒤 분산분석(ANOVA)를 진행하여 3개 이상의 집단을 비교한다. 

> k개의 모집단을 분산분석에서는 k 레벨 이라고 부른다. 

분산분석을 수행함에 있어서 알아보고자 하는 것은 **3개 이상의 집단의 표본평균이 모두 같은가** 이고 이에 가설은 아래와 같이 설정할 수 있다.
* 귀무가설 $H_0: \mu_1 = \mu_2 = ... = \mu_k$
* 대립가설 $H_1:$ 표본평균이 모두 같이 않다.


## 분산분석 자료의 기본 형태
분산분석을 수행할 때 사용되는 자료는 아래와 같은 형태를 띄고 있다. 아래 자료는 One-Way ANOVA Model이라고 부른다. Factor가 하나이기 때문이다. 

|                       | Replicate 1    | Replicate 2    |       ...            | Replicate n    |
| --------------------- | -------------- | -------------- | -------------- | -------------- |
| Factor Level 1        | $y_{11}$       | $y_{12}$       | $y_{1j}$       | $y_{1n}$       |
| Factor Level 2        | $y_{21}$       | $y_{22}$       | $y_{2j}$       | $y_{2n}$       |
| ....                  | $y_{i1}$       | $y_{i2}$       | $y_{ij}$       | $y_{in}$               |
| Factor Level $\alpha$ | $y_{\alpha 1}$ | $y_{\alpha 2}$ | $y_{\alpha j}$ | $y_{\alpha n}$ |

* 를 들어 온도에 따른 철의 연성정도를 알아보고자 할 때 Factor는 온도에 해당하고 각 온도(750도, 800도, ...)는 Level에 해당하고 반복횟수는 Replicate에 해당한다. 
* ${y_{ij}}$는 Level i에서 j번째 관측치인 것이다. 
* $\mu_i$는 Level i의 평균으로 $\mu_i = \sum^n_{j=1}y_{ij} \div n$ 인 것이다.  


**그렇다면 AVOVA 분석은 어떻게 할 수 있을까** 
결론분터 말하면 SSA와 SSE를 비교함으로써 AVOVA 분석(가설검정)을 할 수 있다. 

$Y_{ij} = \mu_i + \epsilon_{ij}$ : i번째 레벨에 j번째 관측치(j번째 반복된 값)는 i번째 평균과 오차항의 합으로 이루어진다. 이때 오차항은 평균이 0이고 분산이 $\sigma^2$인 정규분포를 따른다. ($\epsilon_{ij} \sim N(0, \sigma^2)$) 


i번째 레벨의 관측치 평균의 추정량 $\hat{\mu_i}$은 
$$\hat{\mu_i}=\overline{Y}_{i\bullet} = \cfrac{\sum^n_{j=1}Y_{ij}}{n}$$

이고 전체 관측치 평균의 추정량 $\hat{\mu}$는 
$$\hat{\mu} = \overline{Y}_{\bullet\bullet} = \cfrac{\sum^k_{i=1}\sum^n_{j=1}Y_{ij}}{nk}$$
이다.  

[[전체 제곱합(SST)]]
각각의 관측치에다가 전체 평균을 빼고 제곱을 취한 값을 모두 더했다.
$$S S \mathrm{~T}=\sum_{i=1}^k \sum_{j=1}^n\left(y_{i j}-\bar{y}_{\bullet\bullet}\right)^2=n \sum_{i=1}^k y_{i j}^2-(n k) \bar{y}_{\bullet \bullet}{ }^2$$

[[Level sum of sqares(SSA)]]
i번째 레벨의 평균에서 전체 평균을 빼고 제곱을 취한 값을 모두 더한것으로 **각 레벨간의 차이**가 있는지 확인하는 것이다. 
$$S S \mathrm{A}=\sum_{i=1}^k \sum_{j=1}^n\left(y_{i \bullet}-\bar{y}_{\bullet\bullet}\right)^2=n \sum_{i=1}^k (\bar{y}_{i\bullet} - \bar{y}_{\bullet \bullet})^2$$

[[오차제곱합(SSE)]]
i번째 레벨에 j번째 관측치에서 i번째 레벨의 평균을 빼고 제곱을 취한 값을 모두 더한것으로 **각 레벨 내에서의 차이**(변동)을 확인하는 것이다. 
$$S S \mathrm{E}=\sum_{i=1}^k \sum_{j=1}^n\left(y_{ij}-\bar{y}_{i\bullet}\right)^2$$

SST, SSA, SSE 모두 분산에 일종이다.

> 각각의 자유도는 아래와 같다.
> SST: nk-1
> SSA: k -1
> SSE: SST의 자유도 - SSA의 자유도 = nk-1 -(k-1) = k(n-1) 

따라서 모두 카이제곱분포를 따른다.
그리고 카이제곱 분포의 비율은 F 통계량이고 F 통계량은 f분포를 따른다. 


다시 돌아와서 AVOVA 분석을 왜 하는 것인가? 3개 이상의 모집단(3개 이상의 레벨)의 평균이 같은지 가설검정을 하기 위해서 AVOVA 분석을 수행한다. 
이에 **레벨 간 변동(SSA)가 레벨 내 변동(SSE)보다 충분히 크다면 레벨간의 차이가 있고 귀무가설을 기각할 수 있다.** (변동과 분산은 같은 의미이다.)

위 내용에 대하여 $SSA/SSE$ 로 나타내었을 때 아래와 같이 정리할 수 있다.
* $SSA / SSE = 1$ 두 값이 같을 경우 레벨 간 분산과 레벨 내 분산의 값이 같은 것이다. 이 경우 비교할 수 없다.
* $SSA / SSE > 1$ : 레벨 간의 차이가 레벨 내의 변동보다 충분히 큼으로 귀무가설을 기각할 수 있다.
* $SSA/SSE < 1$ : 레벨 내의 분산이 크기에 레벨 간의 차이가 있다 하더라도 신뢰성을 가지기 어렵다. 따라서 귀무가설을 기각하기 어렵다. 

위 내용을 토대로 AVOVA 분석을 실시 할 때 문제가 있다. $SSA/SSE$ 의 분포가 알려져 있지 않다는 것이다. (카이제곱과 카이제곱간의 비율은 분포가 없다)이 때 SSA와 SSE의 각각의 자유도로 나누어준 MSA와 MSE이고 $MSA / MSE$ 는 F분포를 따른다. 이에 위 $SSA / SSE$ 가 1보다 클 경우 가설을 기각하였던 것을 $MSA/MSE$가 f분포표의 값보다 클 경우 가설을 기각하는 것과 같다. 
따라서 아래 수식이 성립할 때 귀무가설을 기각할 수 있다.
$$F^* = \cfrac{MSA}{MSE} > f_{\alpha, k-1, k(n-1)}$$
> $MSA = SSA / (k-1)$ , $MSE = SSE/k(n-1)$ 

위의 내용을 한번에 정리한 테이블이 있다. 이 테이블을 AVOVA Table 이라고 부른다. 
| Source | DF  | SS  | MS  | F   |
| ------ | --- | --- | --- | --- |
| Level  | k-1 | SSA | MSA | $F^*$*   |
| Error  |     |     |     |     |
| Total  |     |     |     |     |
