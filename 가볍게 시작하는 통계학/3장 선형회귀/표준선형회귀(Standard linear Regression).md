# 개요
선형 회귀는 알려진 다른 관련 데이터 값을 사용하여 알 수 없는 데이터의 값을 예측하는 데이터 분석 기법이다.
알 수 없는 변수 또는 종속 변수와 알려진 변수 또는 독립 변수를 선형 방정식으로 수학적으로 모델링한다.
표준선형회귀의 기본적인 형태는 아래와 같다.(다중선형회귀의 형태가 선형회귀의 표준 형태이다.)
$$Y=\beta_0+\beta_1 X_1+\beta_2 X_2+\cdots+\beta_p X_p+\epsilon$$

위의 표준선형회귀식을 단순화한 단순선형회귀를 먼저 알아본 뒤 다중선형회귀에 대하여 알아보자.

## 선형모델의 가정
표준선형회귀모델은 실제로(현실에서)는 성립되지 않는 몇가지 제한적인 가정을 사용한다. 이중 가장 중요한 가정  중 두가지는 설명변수와 반응변수 사이의 관계는 가산적(additive)이고 선형적이라는 것이다.

* 가산성(가산적): 설명변수 $X_j$의 변화가 반응변수 Y에 미치는 영향은 다른 설명변수 값에 **독립적**이다.
* 선형성(선형적): 설명변수 $X_j$의 한 유닛 변화로 인한 Y의 변화는 $X_j$의 값에 관계없이 **상수**이다. 

현실적인 모델을 만들기 위해 위와 같은 가정을 완화하는 여러가지 기법이 존재한다. 이는 아래 선형모델의 확장부분에서 다루어보자. 

# 단순선형회귀
![[단순선형회귀]]

# 다중선형회귀
![[다중선형회귀]]
![[단순선형회귀]]


# 회귀모델에서 고려할 사항들

## 범주형(질적) 설명변수 모델
남과 여, 낮과 밤, 한우 등급과 같이 레벨(수준) 수가 지정되어 있는 범주형(질적) 설명변수를 사용하는 경우 지시변수(indicator variable) 또는 가변수(dummy variable)을 생성함으로써 설명변수를 모델에 적합(훈련)할 수 있다.

예를 들어 gender(남과 여) 변수를 기반으로 아래와 같은 형태의 새로운 변수를 만들 수 있다.
$$x_i\begin{cases}\,\,1 & \text { i 번째 사람이 여성인 경우 } \\\\ \,\,0 & \text{ i 번째 사람이 남성인 경우}\end{cases}$$
그리고 이 변수를 회귀식의 한 설명변수로 사용한 회귀모델은 아래와 같이 작성될 수 있다. 
(2레벨 범주형 설명변수의 경우 아래와 같이 단순선형회귀로 작성될 수 있다.)
$$y_i=\beta_0+\beta_1 x_i+\epsilon_i= \begin{cases}\,\,\beta_0+\beta_1+\epsilon_i & \text{i 번째 사람이 여성인 경우} \\\\\,\, \beta_0+\epsilon_i & \text{i 번째 사람이 남성인 경우}\end{cases}$$

예를 들어 신용카드 대금 정보를 위 모델에 적용하였을 때 아래와 같은 값을 얻었다고 하자. 

|              | 계수   | 표준편차 | t-value | p-값     |
| ------------ | ------ | -------- | ------- | -------- |
| 절편         | 509.80 | 33.13    | 15.389  | < 0.0001 |
| gender(여성) | 19.73  | 46.05    | 0.429   | 0.6690   |
<교재의 표 3.7>

이를 통해 아래와 같은 사실들을 알 수 있다.
* $\beta_0$의 값은 509.80이고 이는 남성의 평균 신용카드 대금으로 추정 된다.
* 여성의 신용카드 대금은 절편에서 gender 계수를 더한 509.8 + 19.73 = 529.53 으로 추정된다. 
* 가변수(gender)에 대한 p-값이 매우 높음으로 평균 신용카드 대금에 있어서 gender에 따른 차이가 존재한다는 통계적 증거가 없음을 나타낸다. 

위에서는 가변수를 1 과 0으로 설정하였는데 필요에 따라 서로 다른 숫자를 사용하여도 좋다. 다른 가변수값을 사용하여도 남성과 여성의 신용카드 대금에 대한 최종 예측값을 동일하다. 
<br>

만약 3개 이상의 범주가 있다면 아래와 같이 다중선형회귀 형태로 작성될 수 있다. 
$$x_{i1}\begin{cases}\,\,1 & \text { i 번째 사람이 아시아인 경우 } \\\\ \,\,0 & \text{ i 번째 사람이 아시아인이 아닌 경우}\end{cases}$$
$$x_{i2}\begin{cases}\,\,1 & \text { i 번째 사람이 백인 경우 } \\\\ \,\,0 & \text{ i 번째 사람이 백인이 아닌 경우}\end{cases}$$

$$y_i=\beta_0+\beta_1 x_{i1}+\beta_1 x_{i2}+\epsilon_i= \begin{cases}\,\,\beta_0+\beta_1+\epsilon_i & \text{i 번째 사람이 아시아인 경우}\\\\\,\,\beta_0+\beta_2+\epsilon_i & \text{i 번째 사람이 백인 경우}\\ \\\,\, \beta_0+\epsilon_i & \text{i 번째 사람이 흑인 경우}\end{cases}$$

#질문 
> 질문: 위 2레벨 범주형 자료의 경우 밀집 여부에 따라서 남성인지 여성인지 구분할 수 있었는데 아래의 값우 아시아인과 백인은 구분하기 어렵다. 구분할 수 있는 방법이 있는 것인가?
> 
>동시에 1일 경우는 없음, 둘 중 하나가 1이거나, 전부 0이 된다. 
> #재질문
>  만약에 $\beta_1$과 $\beta_2$의 값이 같다면 아시아인인 경우와 백인인 경우의 $y_i$는 구분할 수 없지 않을까?
>  ![[FIGURE 3.7.png|300]]
> 위 이미지와 같이 구분되는 선형상을 통해 다른 범주(카테고리컬) 임을 구분할 수 있는데 $\beta_1$과 $\beta_2$의 값이 같거나 유사할 경우 구분하기 어렵지 않을까?
>$$y_i=\beta_0+\beta_1 x_{i1}+\beta_1 x_{i2}+\epsilon_i= \begin{cases}\,\,\beta_0+\beta_1+\epsilon_i & \text{i 번째 사람이 아시아인 경우}\\\\\,\,\beta_0+\beta_2+\epsilon_i & \text{i 번째 사람이 백인 경우}\\ \\\,\, \beta_0+\epsilon_i & \text{i 번째 사람이 흑인 경우}\end{cases}$$
>![[스크린샷 2023-02-27 오후 10.48.12.png]]
>흑인을 기준으로 둔 예측은 531.00이다. 아시아계는 흑인보다도 18.69적고, 백인은 흑인보다도 12.50적다. 하지만 2개의 더미 변수의 계수의 추정치에 관한 p값은 크기 때문에, 인종 간 신용카드 사용액은 통계적인 차이가 없다고 생각할 수 있다. 다른 기준(베이스 라인)을 잡으면 p값은 변화하지만, 최종 예측치는 동일하다.

## 선형모델의 확장
위 개요부분에서 표준선형모델은 실제로는 성립되지 않는 제한적인 가정들을 사용하고 이 중 가산성과 선형성에 대하여 소개하였었다. 이 장에서는 위 두 가정을 완화시키는 고전적인 기법에 대하여 알아보자. 

>* 가산성(가산적): 설명변수 $X_j$의 변화가 반응변수 Y에 미치는 영향은 다른 설명변수 값에 **독립적**이다.
>* 선형성(선형적): 설명변수 $X_j$의 한 유닛 변화로 인한 Y의 변화는 $X_j$의 값에 관계없이 **상수**이다. 

### 가산성 가정의 제거 - 양적 설명변수

#### 가정 및 문제제기
예를 들어 공장의 생산성을 연구한다고 가정해보자. 생산 라인의 수(lines)와 총 근로자의 수(workers)를 기반으로 생산된 제품의 수(units)을 예측하고자 한다. 

생산 라인의 수가 많아도 총 근로자의 수가 적으면 제품 생산량의 증가로 이어지지 않으며 또한 근로자의 수가 많더라도 생산 라인의 수가 적으면 생산량의 증가로 이어지지 않는다. 이는 생산 라인의 수와 총 근로자의 수 간에 상관관계가 있음을 나타낸다. 이것을 마케팅에서는 **시너지 효과**라고 하고 통계학에서는 **상호작용 효과**라고 한다. 

위의 예시와 같이 두 설명변수가 상호작용 효과를 가졌음에도 가산성에 근거(각 설명변수들은 다른 설명변수에게 영향을 주지 않는다.)하여 생성된 선형모델은 한계를 가진다. 

#### 해결방법 - 상호작용항
위와 같은 가산성 가정의 문제는 상호작용 효과를 포함하는 **상호작용항**이라 불리는 설명변수를 모델에 포함하여 해결 할 수 있다.
위 예시에서 생산 라인의 수를 $X_1$이라고 하고 총 근로자의 수를 $X_2$라고 할 때 두 개의 변수를 가지는 일반적인 표준 선형회귀모델은 아래와 같이 구성될 것이다. 
$$Y=\beta_0+\beta_1 X_1+\beta_2 X_2 +\epsilon$$
이를 $X_1$과 $X_2$의 곱으로 구성된 상호작용항을 포함하면 아래와 같이 구성 할 수 있다.
$$Y=\beta_0+\beta_1 X_1+\beta_2 X_2 + \beta_3X_1X_2 + \epsilon$$
이를 정리하여 일반적인 표준선형회귀모델 형태로 표현하였을 때
$$Y=\beta_0 \tilde{\beta_1}X_1 + \beta_2 X_2 + \epsilon \,\,\,\,\,\,\,\,\,where \,\,\tilde{\beta_1} = \beta_1 + \beta_3X_2$$
$\tilde{\beta_1}$은 $X_2$에 영향을 받음으로 가산성의 가정을 완화하였음을 확인할 수 있다.
또한 $\tilde{\beta_1}$은 $X_2$에 따라 변하므로 Y에 대한 $X_1$의 효과는 더 이상 상수가 아님을 통해 선형성의 가정 또한 완화되었음을 확인 할 수 있다. 

### 가산성 가정의 제거 - 질적 설명변수
질적 설명변수가 존재하는 경우에도 가변수를 추가함으로써 상호작용의 개념을 적용할 수 있다.
예를 들어 수입(income)과 학생신분의 유무(student)를 통해 신용카드 대금(balance)를 예측하고자 한다고 하자.(이때 수입은 양적변수이고 학생신분의 유무는 질적변수이다. 아래에서 학생일 경우 1을 학생이 아닌 경우 0을 사용하여 표현하겠다.)

먼저 상호작용항이 없는 표준선형회귀모델은 아래와 같이 작성될 것이다. 
$$\begin{aligned} \text {balance}_i & \approx \beta_0+\beta_1 \times \text {income}_i+ \begin{cases}\beta_2 & \text{ i 번째 사람이 학생인 경우} \\ 0 & \text { i 번째 사람이 학생이 아닌 경우 }\end{cases} \\ & =\beta_1 \times \text {income}_i+ \begin{cases}\beta_0+\beta_2 & \text { i 번째 사람이 학생인 경우 } \\ \beta_0 & \text { i 번째 사람이 학생이 아닌 경우 }\end{cases} \end{aligned}$$
위 모델에 상호작용항을 포함하여 아래와 같이 구성 할 수 있다. 
$$\begin{aligned} \text {balance}_i & \approx \beta_0+\beta_1 \times \text {income}_i+ \begin{cases}\beta_2 + \beta_3 \times \text{income}_i & \text{ i 번째 사람이 학생인 경우} \\ 0 & \text { i 번째 사람이 학생이 아닌 경우 }\end{cases} \\ & =\beta_1 \times \text {income}_i+ \begin{cases}(\beta_0+\beta_2) + (\beta_1 + \beta_3) \times \text{income}_i & \text { i 번째 사람이 학생인 경우 } \\ \beta_0 + \beta_1 \times \text{income}_i & \text { i 번째 사람이 학생이 아닌 경우 }\end{cases} \end{aligned}$$

위 두 모델을 아래 그래프를 참고하여 비교하여보자.
![[FIGURE 3.7.png]]
<income으로부터 balnace를 예측하기 위한 최소제곱선으로 왼쪽은 상호작용항이 없는 모델이고 오른쪽은 상호작용항이 있는 모델이다.>

상호작용항이 없는 모델의 경우 두 직선은 $\beta_0 + \beta_2$와 $\beta_0$으로 다른 절편을 가지지만 $\beta_1$로 동일한 기울기를 가져 평행하다. 이는 학생신분의 유무가 소득과 신용카드 대금 사이에 주는 상호작용 효과가 없음을 의미하고 이는 잘못된 결론이다. 왜냐하면, 현실에서 소득의 변화는 학생신분의 유무에 따라 신용카드 대금에 아주 다른 효과를 주기 때문이다. 

상호작용이 있는 모델의 경우 두 직선은 $\beta_0+\beta_2$과 $\beta_0$으로 다른 절편을 가지며 $\beta_1 + \beta_3$와 $\beta_1$로 다른 기울기를 가진다. 이는 소득 변화가 신용카드 대금에 미치는 영향이 학생인지 여부에 따라 다를 수 있다는 것을 시사하며 그래프를 통해 소득 증가에 따른 카드 대금 증가가 학생인 경우 학생이 아닌 사람보다 낮다(low)는 올바른 결론을 도출할 수  있다. 

위와 같이 질적 설명변수에 대해서도 상호작용항을 추가함을 통해 실제에 맞는(현실적인) 모델을 형성 할 수 있음을 확인할 수 있다. 


